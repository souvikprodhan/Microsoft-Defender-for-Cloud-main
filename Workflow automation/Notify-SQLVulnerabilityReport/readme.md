# Notify database security owners of vulnerabilities on SQL servers/machines
### Author: Ameer Tayyem

### Overview
The Logic App allows you to send a weekly vulnerability report for SQL databases on servers/machines.
Once triggered, the defined recipients receive an email report for every SQL server (i.e. Azure SQL server and SQL server on VM/On-Premise) connected to Microsoft Defender for Cloud.
The email report summarizes the weekly vulnerability scan for every database.
After a successful deployment, you must authorize Office 365 connector to generate valid access tokens for authenticating your credentials â€“ detailed instructions below.

### Instructions

1. Click on the **Deploy to Azure** button to create the Logic App in a target resource group:

<a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FMicrosoft-Defender-for-Cloud%2Fmain%2FWorkflow%2520automation%2FNotify-SQLVulnerabilityReport%2Fazuredeploy.json" target="_blank">
<img src="https://aka.ms/deploytoazurebutton"/></a>

> ðŸ’¡ The deployment grants *Security Reader* (built-in role) to the Logic App's Managed Identity on the subscription where it is being deployed. The Active Directory principal that deploys the template must be assigned as *Owner* or *User Access Administrator* on the subscription.

2. Authorize Logic App connection: *office365-Notify-SQLVulnerabilityReport*:

    * From the Logic App's sidebar, select **API connections**.
    * Select **office365-Notify-SQLVulnerabilityReport** connection.
    * From the sidebar, select **Edit API connection**.
    * Select **Authorize** and authenticate using your credentials.
    * Select **Save** to apply your changes.

3. **Optional** - To monitor SQL servers in additional subscriptions, you should grant *Security Reader* (built-in role) to the Logic App's Managed Identity on the subscriptions you want to monitor:

    * Go to the subscription page.
    * Select **Access Control (IAM)** on the navigation bar.
    * Select **+Add** and **Add role assignment**.
    * Select the respective role **Reader** (built-in).
    * Assign access to Logic App.
    * Select the subscription where the logic app was deployed and then select `Notify-SecurityIssues` Logic App.
    * Select **Save**.