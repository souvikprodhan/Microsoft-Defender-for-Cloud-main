# Enable Continuous Export filtered by Defender Plan

| Version | Description | Author | Date |
| ------ | ------ | ------ | ------ |
| 1.0 | Initial release | [Alessio Moretti](https://github.com/alessiomoretti)| Mar 30, 2023|

## Scenario
Built-in Azure Policies to enable the Continuous Export to Log Analytics Workspace or Event Hub are not filtering the alerts by the Defender for Cloud plan that is generating them. At time of writing, filter is available only by Severity. Organizations may require to filter alerts based on a specific subset of originating sources (e.g., all alerts generated by Defender for Containers).

## Custom Policy Design Principle 
The custom policies in this folder will cover the use to filter the alerts by the `ProductComponentName` field in the raw JSON of the generated alert. 

## Deployed Resources
The custom policy will deploy (optionally) a Resource Group and a `Microsoft.Security/Automations` resource  that will filter the alerts based on the `ProductComponentName` property and then forward them to the selected data sink (Log Analytics Workspace or Event Hub).

### Notes on Usage
- This custom policy replaces the filter by Alerts Severity with a filter by `ProductComponentName` property
- The `ProductComponentName` property is available also raw JSON of the alert. You can find it in the `properties` section of the alert
- If you need to correlate alerts, you can use the [built-in policy for LAW Continuous Export](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ExportToLogAnalyticsWorkspace_DINE.json) and the [built-in policy for Event Hub Continuous Export](https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Security%20Center/ASC_ExportToEventHubASCAlertsAndRecommendations_DINE.json)
  - Having all the alerts in the same data sink will allow you to correlate them 