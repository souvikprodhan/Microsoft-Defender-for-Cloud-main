{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Defender for Servers Deployment Status",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "Azure Security Center",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Defender for Servers deployment status\\n\\nAs previously announced, Log Analytics agent and the integrated Qualys vulnerability assessment solution will be deprecated by summer 2024. At the same time, we will provide updated server protection capabilities on top of Microsoft Defender for Endpoint (MDE) as a single security agent, and agentless scanning.\\nTo be prepared for upcoming changes, Defender for Servers customers are encouraged to enable both, MDE integration and agentless scanning as part of their Defender for Servers deployments across multicloud environments.\\nThis workbook provides insights into the deployment status of agentless scanning, MDE, Qualys VA and Log Analytics agent.\\n\"},\"name\":\"intro\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"89bf65ba-5407-4b0a-b3d6-a973db229ecd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"subscriptions\",\"label\":\"Subscription(s)\",\"type\":6,\"description\":\"Select one or several subscription(s). This filter adheres to the overall Azure portal subscription filter. With that, you can select only subscriptions that are shown based on the overall portal filter.\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":false,\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"value\":[\"value::all\"]},{\"id\":\"fb25118f-8331-4368-b6ab-a2393d748e08\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"info\",\"label\":\"Additional information\",\"type\":10,\"description\":\"Show additional information for this workbook\",\"isRequired\":true,\"value\":\"Off\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\n { \\\"value\\\": \\\"On\\\", \\\"label\\\": \\\"On\\\"},\\n { \\\"value\\\": \\\"Off\\\", \\\"label\\\": \\\"Off\\\"}\\n]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 0\"},{\"type\":1,\"content\":{\"json\":\"## How to use the parameters\\n\\n|Parameter|Description|\\n|---|---|---|\\n| Subscription(s) | Select one, several, or all subscriptions in your environment. The workbook will use this filter to display vulnerabilities according to the selected scope. |\\n| Additional information | Shows this and additional information about this workbook. |\\n\\n## Release notes\\n\\n|Version|Description|Date|\\n|---|---|---|\\n|v1.0|initial release |1/26/2024|\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"releaseNotes\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Defender for Servers coverage across subscriptions\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"This section shows Defender for Servers coverage across all subscriptions. For subscriptions with Defender for Servers Plan 2 enabled, it also shows coverage of agentless scanning, which is a prerequisite to receive full benefits as part of Defender for Servers Plan 2.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"DefenderForServers-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type =~ \\\"microsoft.security/pricings\\\"\\n| extend pricingTier = properties.pricingTier, subPlan = properties.subPlan\\n| extend planSet = pack(name, level = case(isnotempty(subPlan),subPlan,pricingTier))\\n| summarize defenderPlans = make_bag(planSet) by subscriptionId\\n|Â project subscriptionId, VirtualMachines = tostring(defenderPlans.VirtualMachines)\\n| summarize count() by VirtualMachines\\n\",\"size\":3,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"P2\",\"label\":\"Defender for Servers Plan 2 enabled\",\"color\":\"lightBlue\"},{\"seriesName\":\"P1\",\"label\":\"Defender for Servers Plan 1 enabled\",\"color\":\"purple\"},{\"seriesName\":\"Free\",\"label\":\"Defender for Servers disabled\",\"color\":\"pink\"}]}},\"customWidth\":\"30\",\"name\":\"DefenderForServers-coverage\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type =~ \\\"microsoft.security/pricings\\\" and name =~ \\\"VirtualMachines\\\"\\n| extend pricingTier = tostring(properties.pricingTier), subPlan = tostring(properties.subPlan)\\n| mv-expand extensionSettings = properties.extensions\\n| extend planSet = pack (tostring(extensionSettings.name), tostring(extensionSettings.isEnabled))\\n| summarize extensions = make_bag(planSet) by subscriptionId, subPlan, pricingTier\\n| project subscriptionId,\\n    pricingTier,\\n    subPlan,\\n    AgentlessVmScanning = extensions.AgentlessVmScanning\",\"size\":1,\"showAnalytics\":true,\"title\":\"Defender for Servers coverage details\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"pricingTier\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Standard\",\"text\":\"Enabled\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"\"}]},\"tooltipFormat\":{\"tooltip\":\"This column shows if Defender for Servers is enabled on your subscriptions.\"}},{\"columnMatch\":\"subPlan\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"P1\",\"text\":\"Plan 1\"},{\"operator\":\"==\",\"thresholdValue\":\"P2\",\"text\":\"Plan 2\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"\"}]},\"tooltipFormat\":{\"tooltip\":\"This column shows the Defender for Servers plan that is enabled on your subscriptions.\"}},{\"columnMatch\":\"AgentlessVmScanning\",\"formatter\":18,\"formatOptions\":{\"linkColumn\":\"subscriptionId\",\"linkTarget\":\"OpenBlade\",\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"Enabled\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"disabled\",\"text\":\"Disabled\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"not applicable\"}],\"bladeOpenContext\":{\"bladeName\":\"DataCollectionBladeV2\",\"extensionName\":\"Microsoft_Azure_Security\",\"bladeParameters\":[{\"name\":\"subscriptionId\",\"source\":\"column\",\"value\":\"subscriptionId\"},{\"name\":\"defendersPlan\",\"source\":\"static\",\"value\":\"Servers\"}]}},\"tooltipFormat\":{\"tooltip\":\"Agentless scanning should be enabled on every subscription with Defender for Servers Plan 2 coverage.\"}}],\"rowLimit\":1000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"subscriptionId\",\"label\":\"Subscription\"},{\"columnId\":\"pricingTier\",\"label\":\"Defender for Servers status\"},{\"columnId\":\"subPlan\",\"label\":\"Defender for Servers plan\"},{\"columnId\":\"AgentlessVmScanning\",\"label\":\"Agentless scanning status\"}]}},\"customWidth\":\"70\",\"name\":\"DefenderForServers-query\"}]},\"name\":\"DefenderForServers-group\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Log Analytics agent coverage across machines\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"This section shows information about all machines in selected subscriptions that are equiped with the legacy Log Analytics agent. In addition, for each of those machines, the table shows information about the Defender for Endpoint deployment status as this agent is mandatory to receive full server protection coverage as part of Defender for Servers plans in Defender for Cloud.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"MMA-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\n| where type in (\\\"microsoft.compute/virtualmachines\\\",\\\"microsoft.hybridcompute/machines\\\")\\n| extend resourceId = tolower(id)\\n| join kind = fullouter ( \\n    resources\\n| where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\")\\n| where properties.type in (\\\"OmsAgentForLinux\\\", \\\"MicrosoftMonitoringAgent\\\")\\n| extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id)), status = case(isnotempty(name), \\\"MMA\\\", \\\"\\\")\\n) on resourceId\\n| summarize count() by status\",\"size\":3,\"title\":\"Log Analytics agent usage on machines across selected subscriptions\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"MMA\",\"label\":\"MMA deployed\",\"color\":\"pink\"},{\"seriesName\":\"\",\"label\":\"not deployed\",\"color\":\"lightBlue\"}]}},\"customWidth\":\"30\",\"name\":\"MMA-coverage\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\n| where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\") and properties.type in (\\\"OmsAgentForLinux\\\", \\\"MicrosoftMonitoringAgent\\\")\\n| extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id))\\n| join kind = inner  (\\n    resources | where type in (\\\"microsoft.compute/virtualmachines\\\",\\\"microsoft.hybridcompute/machines\\\")\\n| extend resourceId = tolower(id)\\n) on resourceId\\n|project subscriptionId, resourceGroup, resourceId, workspaceId = tostring(properties.settings.workspaceId)\\n| join kind = inner ( \\n    resources\\n| where type == \\\"microsoft.operationalinsights/workspaces\\\"\\n| project id, workspaceId = tostring(properties.customerId)\\n) on workspaceId\\n| join kind = leftouter (\\n    resources\\n    | where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\")\\n    | where properties.type in (\\\"MDE.Linux\\\", \\\"MDE.Windows\\\")\\n    | extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id))\\n) on resourceId\\n| project subscriptionId, resourceGroup, resourceId, id, extensionName = tostring(properties.type), provisioningState = tostring(properties.provisioningState)\\n| sort by subscriptionId, resourceGroup\",\"size\":0,\"showAnalytics\":true,\"title\":\"Machines with Log Analytics agent deployed\",\"noDataMessage\":\"No machines with Log Analytics agent found. There are no further actions pending as part of Log Analytics agent deprecation.\",\"noDataMessageStyle\":3,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"resourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true,\"customColumnWidthSetting\":\"32.5ch\"}},{\"columnMatch\":\"resourceId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"32.5ch\"},\"tooltipFormat\":{\"tooltip\":\"This column shows all Azure VMs and Azure Arc-enabled servers across your subscriptions that have the legacy Log Analytics agent deployed.\"}},{\"columnMatch\":\"id\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"35ch\"},\"tooltipFormat\":{\"tooltip\":\"The connected workspace column shows the Log Analytics workspace the agent is connected to.\"}},{\"columnMatch\":\"extensionName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"MDE.Linux\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"MDE.Windows\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"disabled\",\"text\":\"Extension missing\"}]},\"tooltipFormat\":{\"tooltip\":\"The Defender for Endpoint extension column shows if the Defender for Endpoint extension is deployed to your machine, and if so, if it is the Windows, or Linux extension that is being used.\"}},{\"columnMatch\":\"provisioningState\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Succeeded\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Failed\",\"representation\":\"4\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"\"}]},\"tooltipFormat\":{\"tooltip\":\"The provisioning state indicates if Defender for Endpoint was successful installed inside the operating system.\"}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"labelSettings\":[{\"columnId\":\"subscriptionId\",\"label\":\"Subscription\"},{\"columnId\":\"resourceGroup\",\"label\":\"Resource Group\"},{\"columnId\":\"resourceId\",\"label\":\"Affected machine\"},{\"columnId\":\"id\",\"label\":\"Connected workspace\"},{\"columnId\":\"extensionName\",\"label\":\"Defender for Endpoint extension\"},{\"columnId\":\"provisioningState\",\"label\":\"Provisioning state\"}]}},\"customWidth\":\"70\",\"name\":\"MMA-machines\"}]},\"name\":\"MMA-group\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Defender for Endpoint coverage across machines\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"This section shows Defender for Endpoint coverage across all machines in selected subscriptions.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"MDE-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\n| where type in (\\\"microsoft.compute/virtualmachines\\\",\\\"microsoft.hybridcompute/machines\\\")\\n| extend resourceId = tolower(id)\\n| join kind = fullouter ( \\n    resources\\n| where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\")\\n| where properties.type in (\\\"MDE.Linux\\\", \\\"MDE.Windows\\\")\\n| extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id)), status = case(isnotempty(name), \\\"MDE\\\", \\\"\\\")\\n) on resourceId\\n| summarize count() by status\",\"size\":3,\"title\":\"Defender for Endpoint extension coverage\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"MDE\",\"label\":\"Defender for Endpoint deployed\",\"color\":\"lightBlue\"},{\"seriesName\":\"\",\"label\":\"not deployed\",\"color\":\"pink\"}]}},\"customWidth\":\"30\",\"name\":\"MDE-coverage\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\n| where type in (\\\"microsoft.compute/virtualmachines\\\",\\\"microsoft.hybridcompute/machines\\\")\\n| extend resourceId = tolower(id)\\n| join kind = leftouter ( \\n    resources\\n| where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\") and properties.type in (\\\"MDE.Linux\\\", \\\"MDE.Windows\\\")\\n| extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id))\\n) on resourceId\\n| project subscriptionId, resourceGroup, resourceId, extensionName = name1, provisioningState = properties1.provisioningState\\n| sort by subscriptionId, resourceGroup\",\"size\":0,\"showAnalytics\":true,\"title\":\"Machines with MDE extension deployed\",\"noDataMessage\":\"No machines with MDE extension found. Either extend your subscription filter, or make sure to enable auto deployment of Microsoft Defender for Endpoint.\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"resourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"resourceId\",\"formatter\":0,\"tooltipFormat\":{\"tooltip\":\"This column shows all your Azure VMs and Azure Arc-enabled servers across your subscriptions.\"}},{\"columnMatch\":\"extensionName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"is Empty\",\"representation\":\"disabled\",\"text\":\"Extension missing\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"success\",\"text\":\"{0}{1}\"}]},\"tooltipFormat\":{\"tooltip\":\"The Defender for Endpoint extension column shows if the Defender for Endpoint extension is deployed to your machine, and if so, if it is the Windows, or Linux extension that is being used.\"}},{\"columnMatch\":\"provisioningState\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Succeeded\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Failed\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}]},\"tooltipFormat\":{\"tooltip\":\"The provisioning state indicates if Defender for Endpoint was successful installed inside the operating system.\"}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"sortBy\":[{\"itemKey\":\"$gen_link_resourceId_3\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"subscriptionId\",\"label\":\"Subscription\"},{\"columnId\":\"resourceGroup\",\"label\":\"Resource Group\"},{\"columnId\":\"resourceId\",\"label\":\"Affected machine\"},{\"columnId\":\"extensionName\",\"label\":\"Defender for Endpoint extension\"},{\"columnId\":\"provisioningState\",\"label\":\"Provisioning state\"}]},\"sortBy\":[{\"itemKey\":\"$gen_link_resourceId_3\",\"sortOrder\":1}]},\"customWidth\":\"70\",\"name\":\"MDE-machines\"}]},\"name\":\"MDE-group\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Qualys VA coverage across machines\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"This section shows the integrated Qualys VA extension deployed across all machines in selected subscriptions. After migrating the vulnerability assessment provider to Microsoft Defender Vulnerability Management (MDVM), we recommend to remove the Qualys VA extension from your machines. Please read [this documentation](https://learn.microsoft.com/en-us/azure/defender-for-cloud/how-to-transition-to-built-in) to learn more about how to transition from Qualys to MDVM as part of Defender for Servers.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"MDE-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\n| where type in (\\\"microsoft.compute/virtualmachines\\\",\\\"microsoft.hybridcompute/machines\\\")\\n| extend resourceId = tolower(id)\\n| join kind = fullouter ( \\n    resources\\n| where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\")\\n| where properties.type in (\\\"WindowsAgent.AzureSecurityCenter\\\", \\\"LinuxAgent.AzureSecurityCenter\\\")\\n| extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id)), status = case(isnotempty(name), \\\"Qualys VA\\\", \\\"\\\")\\n) on resourceId\\n| summarize count() by status\",\"size\":3,\"title\":\"Qualys VA extension coverage\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Qualys VA\",\"label\":\"Qualys VA extension deployed\",\"color\":\"pink\"},{\"seriesName\":\"\",\"label\":\"not deployed\",\"color\":\"lightBlue\"}]}},\"customWidth\":\"30\",\"name\":\"Qualys-coverage\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\n| where type in (\\\"microsoft.compute/virtualmachines\\\",\\\"microsoft.hybridcompute/machines\\\")\\n| extend resourceId = tolower(id)\\n| join kind = inner ( \\n    resources\\n| where type in (\\\"microsoft.compute/virtualmachines/extensions\\\",\\\"microsoft.hybridcompute/machines/extensions\\\")\\n| where properties.type in (\\\"WindowsAgent.AzureSecurityCenter\\\", \\\"LinuxAgent.AzureSecurityCenter\\\")\\n| extend resourceId = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/extensions/*)\\\",1,id))\\n) on resourceId\\n| project subscriptionId, resourceGroup, resourceId, extensionName = name1, provisioningState = properties1.provisioningState\\n| sort by subscriptionId, resourceGroup\",\"size\":0,\"showAnalytics\":true,\"title\":\"Machines with Qualys VA extension deployed\",\"noDataMessage\":\"No machines with Qualys VA extension found. No further action required as part of Qualys VA deprecation.\",\"noDataMessageStyle\":3,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"resourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"extensionName\",\"formatter\":1},{\"columnMatch\":\"provisioningState\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Failed\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Succeeded\",\"representation\":\"1\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}]}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"labelSettings\":[{\"columnId\":\"subscriptionId\",\"label\":\"Subscription\"},{\"columnId\":\"resourceGroup\",\"label\":\"Resource Group\"},{\"columnId\":\"resourceId\",\"label\":\"Affected machine\"},{\"columnId\":\"extensionName\",\"label\":\"Extension name\"},{\"columnId\":\"provisioningState\",\"label\":\"Provisioning state\"}]}},\"customWidth\":\"70\",\"name\":\"Qualys-machines\"}]},\"name\":\"Qualys-group\",\"styleSettings\":{\"showBorder\":true}}],\"isLocked\":false,\"fallbackResourceIds\":[\"Azure Security Center\"],\"fromTemplateId\":\"asc-server-status-dashboard\"}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}